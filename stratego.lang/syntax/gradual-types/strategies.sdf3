module gradual-types/strategies

imports
  gradual-types/signatures
  core/identifiers
  core/strategies
  core/terms

template options
  keyword -/- [a-zA-Z0-9\'\-\_]
  tokenize: ")(|"


sorts Strategy Coercion SCoercion Proxy SVar
context-free syntax
// Extension for highlighting casts
  Strategy.Cast   = [cast([Coercion])]
  Strategy.TypeTest   = [is([Type])]
//  Strategy.TypedCong = [[TypedId]([{Strategy ", "}*])]

  Coercion.Fail = [fail]
  Coercion.Id = [id]
  Coercion.RuntimeCheck = Type

  SCoercion.SFail         = [fail]
  SCoercion.SId           = [id]
  SCoercion.SRuntimeCheck = SType

//  TypedId.TypedId = [[SortT].[Id]]

  Strategy     = Proxy
  Proxy.Proxy  = [proxy([Coercion], [Coercion])([SVar])]
  Proxy.ProxyT = [proxy([{SCoercion ", "}*] | [{Coercion ", "}*])([Coercion], [Coercion])([SVar])]

  SVar = "cast" {reject}

sorts StrategyDef TypedSVar TypedTVar
context-free syntax

  StrategyDef.ExtTypedDef =
    [external [MaybeEmptyId] :: [FunTType]]

  StrategyDef.ExtTypedDefInl =
    [external [MaybeEmptyId]([{ID ", "}*] | [{ID ", "}*]) :: [FunTType] =
  [Strategy]]